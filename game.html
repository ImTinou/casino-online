<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🎰 Blackjack Casino Royal - Jeu</title>
    <link rel="stylesheet" href="style.css">
    <meta name="description" content="Jouez au blackjack multijoueur en temps réel avec jusqu'à 5 joueurs par table.">
    
    <!-- Firebase SDK -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.2/firebase-app-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.2/firebase-database-compat.min.js"></script>
</head>
<body class="game-page">
    <!-- Particules d'ambiance -->
    <div class="particles" id="particles"></div>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <span class="logo-icon">🎰</span>
                <span class="logo-text">Casino Royal</span>
            </div>
            <div class="nav-links">
                <a href="index.html" class="nav-link">🏠 Accueil</a>
                <button class="btn btn-danger btn-small" onclick="leaveGame()" id="leaveBtn" style="display: none;">🚪 Quitter</button>
            </div>
        </div>
    </nav>

    <!-- Lobby Screen -->
    <div id="lobby" class="lobby">
        <div class="casino-logo">🎰 CASINO ROYAL 🎰</div>
        
        <div class="lobby-card">
            <h2>🃏 Table de Blackjack Exclusive</h2>
            <p style="margin: 20px 0; opacity: 0.9;">
                Rejoignez la plus prestigieuse table de blackjack en ligne. 
                Maximum 5 joueurs par partie.
            </p>
            
            <div class="input-group">
                <label for="playerName">👤 Votre nom de joueur :</label>
                <input type="text" id="playerName" placeholder="Entrez votre nom..." maxlength="12">
            </div>

            <div style="display: flex; gap: 20px; justify-content: center; margin-top: 30px; flex-wrap: wrap;">
                <button class="btn btn-gold" onclick="createRoom()">
                    🎯 Ouvrir une table (Croupier)
                </button>
                <button class="btn btn-primary" onclick="showJoinRoom()">
                    🎲 Rejoindre une table
                </button>
            </div>
            
            <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid rgba(255, 215, 0, 0.2);">
                <p style="font-size: 14px; opacity: 0.7; margin-bottom: 10px;">
                    🔥 Multijoueur temps réel • 📱 Mobile friendly • 🔒 Tables privées
                </p>
                <div style="display: flex; justify-content: center; gap: 20px; font-size: 12px; opacity: 0.6;">
                    <span>✅ Sans inscription</span>
                    <span>✅ 100% gratuit</span>
                    <span>✅ Règles officielles</span>
                </div>
            </div>
        </div>

        <div id="joinRoomCard" class="lobby-card" style="display: none;">
            <h3>🎫 Rejoindre une table</h3>
            <p style="margin: 15px 0; opacity: 0.8;">
                Entrez le code de table partagé par votre ami
            </p>
            
            <div class="input-group">
                <label for="roomCode">Code de la table :</label>
                <input type="text" id="roomCode" placeholder="Code à 6 lettres..." maxlength="6" style="text-transform: uppercase;">
            </div>
            
            <div style="display: flex; gap: 15px; justify-content: center; margin-top: 20px;">
                <button class="btn btn-success" onclick="joinRoom()">✅ Entrer à la table</button>
                <button class="btn btn-secondary" onclick="hideJoinRoom()">❌ Annuler</button>
            </div>
        </div>
    </nav>

    <!-- Game Interface -->
    <div id="gameInterface" class="game-interface">
        <div class="container">
            <!-- En-tête de jeu -->
            <div class="game-header">
                <div class="room-info">
                    <div class="connection-status">
                        <div class="status-dot connected" id="connectionDot"></div>
                        <span id="connectionStatus">Connecté</span>
                    </div>
                    <div class="room-code-display" id="gameRoomCode">ABC123</div>
                    <div style="color: #FFD700;">
                        <span id="playerCount">1</span>/5 joueurs
                    </div>
                </div>
                <div>
                    <button class="btn btn-warning" onclick="shareRoom()">📤 Partager</button>
                </div>
            </div>

            <!-- Table de Casino -->
            <div class="casino-table">
                <div class="table-felt"></div>
                <div class="table-shine"></div>
                
                <!-- Position du croupier -->
                <div class="dealer-position">
                    <div class="dealer-avatar">🎩</div>
                    <div class="player-name">Croupier</div>
                    <div class="player-score" id="dealerScore">--</div>
                    <div id="dealerCards" class="cards-area"></div>
                </div>

                <!-- Paquet de cartes -->
                <div class="deck-position">
                    <div class="deck-stack" id="deckStack">
                        <div class="deck-card">🂠</div>
                        <div class="deck-card">🂠</div>
                        <div class="deck-card">🂠</div>
                        <div class="deck-card">🂠</div>
                        <div class="deck-card">🂠</div>
                    </div>
                </div>

                <!-- Positions des joueurs -->
                <div class="player-positions" id="playerPositions">
                    <!-- Les positions seront générées dynamiquement -->
                </div>
            </div>

            <!-- Contrôles de jeu -->
            <div class="game-controls">
                <!-- Contrôles du croupier -->
                <div id="dealerControls" style="display: none;">
                    <button class="btn btn-gold" onclick="startNewHand()" id="dealButton">
                        🎴 Distribuer les cartes
                    </button>
                    <button class="btn btn-warning" onclick="dealerPlay()" id="dealerPlayBtn" style="display: none;">
                        🎲 Tour du croupier
                    </button>
                    <button class="btn btn-secondary" onclick="resetGame()" id="resetBtn">
                        🔄 Nouvelle partie
                    </button>
                </div>
                
                <!-- Contrôles du joueur -->
                <div id="playerControls" style="display: none;">
                    <button class="btn btn-success" onclick="hit()">
                        ⬆️ Prendre une carte
                    </button>
                    <button class="btn btn-danger" onclick="stand()">
                        ✋ Rester
                    </button>
                    <div style="margin-top: 10px; font-size: 14px; opacity: 0.7; text-align: center;">
                        Objectif : Arriver à 21 sans dépasser
                    </div>
                </div>
                
                <!-- État d'attente -->
                <div id="waitingControls" style="display: none;">
                    <div style="text-align: center; color: #FFD700;">
                        <div class="loading"></div>
                        <p style="margin-top: 10px;" id="waitingMessage">En attente du croupier...</p>
                        <p style="font-size: 14px; opacity: 0.7; margin-top: 5px;">
                            Invitez vos amis avec le code ci-dessus
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Styles spécifiques au jeu -->
    <style>
        /* Styles additionnels pour le jeu */
        .casino-table {
            width: 95%;
            max-width: 1200px;
            height: 600px;
            margin: 30px auto;
            background: 
                radial-gradient(ellipse at center, #1B5E20, #2E7D32, #1B5E20),
                linear-gradient(45deg, #0D4F11 0%, #1B5E20 25%, #2E7D32 50%, #1B5E20 75%, #0D4F11 100%);
            border-radius: 50% 50% 45% 45%;
            border: 8px solid #8D6E63;
            box-shadow: 
                0 0 50px rgba(0, 0, 0, 0.8),
                inset 0 0 100px rgba(0, 0, 0, 0.3),
                0 0 100px rgba(255, 215, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .table-felt {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            height: 85%;
            background: 
                repeating-linear-gradient(
                    45deg,
                    transparent,
                    transparent 2px,
                    rgba(255, 255, 255, 0.02) 2px,
                    rgba(255, 255, 255, 0.02) 4px
                );
            border-radius: inherit;
        }

        .table-shine {
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            animation: tableShine 8s infinite;
        }

        @keyframes tableShine {
            0% { left: -100%; }
            50% { left: 100%; }
            100% { left: 100%; }
        }

        /* Positions sur la table */
        .dealer-position {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            z-index: 20;
        }

        .dealer-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            margin: 0 auto 15px;
            border: 4px solid #8D6E63;
            box-shadow: 
                0 0 30px rgba(255, 215, 0, 0.5),
                inset 0 0 20px rgba(0, 0, 0, 0.2);
            animation: dealerGlow 3s ease-in-out infinite;
        }

        @keyframes dealerGlow {
            0%, 100% { box-shadow: 0 0 30px rgba(255, 215, 0, 0.5), inset 0 0 20px rgba(0, 0, 0, 0.2); }
            50% { box-shadow: 0 0 50px rgba(255, 215, 0, 0.8), inset 0 0 20px rgba(0, 0, 0, 0.2); }
        }

        .deck-position {
            position: absolute;
            top: 50%;
            left: 30px;
            transform: translateY(-50%);
            z-index: 15;
        }

        .deck-stack {
            width: 60px;
            height: 90px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .deck-stack:hover {
            transform: scale(1.1);
        }

        .deck-card {
            position: absolute;
            width: 60px;
            height: 90px;
            background: linear-gradient(135deg, #1a237e, #3949ab);
            border-radius: 8px;
            border: 2px solid #FFD700;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #FFD700;
            font-size: 20px;
            font-weight: bold;
        }

        .deck-card:nth-child(1) { transform: rotate(-2deg) translate(2px, 2px); }
        .deck-card:nth-child(2) { transform: rotate(-1deg) translate(1px, 1px); }
        .deck-card:nth-child(3) { transform: rotate(0deg); }
        .deck-card:nth-child(4) { transform: rotate(1deg) translate(-1px, -1px); }
        .deck-card:nth-child(5) { transform: rotate(2deg) translate(-2px, -2px); }

        /* Positions des joueurs */
        .player-positions {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .player-spot {
            position: absolute;
            width: 150px;
            height: 180px;
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 20;
        }

        .player-spot.spot-1 { bottom: 20px; left: 15%; }
        .player-spot.spot-2 { bottom: 20px; left: 32%; }
        .player-spot.spot-3 { bottom: 20px; left: 50%; transform: translateX(-50%); }
        .player-spot.spot-4 { bottom: 20px; right: 32%; }
        .player-spot.spot-5 { bottom: 20px; right: 15%; }

        .player-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4em;
            font-weight: bold;
            border: 3px solid transparent;
            transition: all 0.3s ease;
            margin-bottom: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .player-spot.active .player-avatar {
            border-color: #00ff88;
            box-shadow: 
                0 0 30px rgba(0, 255, 136, 0.6),
                0 5px 15px rgba(0, 0, 0, 0.3);
            animation: activePlayer 2s ease-in-out infinite;
        }

        @keyframes activePlayer {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .player-name {
            font-size: 14px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 5px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        }

        .player-score {
            font-size: 18px;
            font-weight: bold;
            background: rgba(0, 0, 0, 0.6);
            padding: 5px 12px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 5px;
        }

        .player-status {
            font-size: 12px;
            padding: 3px 8px;
            border-radius: 10px;
            text-align: center;
        }

        .player-status.win { background: rgba(0, 255, 0, 0.3); }
        .player-status.lose { background: rgba(255, 0, 0, 0.3); }
        .player-status.tie { background: rgba(255, 255, 0, 0.3); }

        /* Contrôles de jeu */
        .game-controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            z-index: 50;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(15px);
            padding: 20px;
            border-radius: 20px;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }

        .game-controls > div {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 14px;
        }

        /* Responsive pour le jeu */
        @media (max-width: 768px) {
            .casino-table {
                width: 98%;
                height: 450px;
                margin: 20px auto;
            }
            
            .player-spot {
                width: 100px;
                height: 140px;
            }
            
            .player-avatar {
                width: 45px;
                height: 45px;
                font-size: 1.1em;
            }
            
            .dealer-avatar {
                width: 60px;
                height: 60px;
                font-size: 1.5em;
            }
            
            .game-controls {
                bottom: 10px;
                padding: 15px;
                max-width: 95vw;
            }
            
            .game-controls > div {
                flex-direction: column;
                gap: 10px;
            }
            
            .game-header {
                padding: 15px 20px;
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .room-info {
                gap: 20px;
                flex-wrap: wrap;
                justify-content: center;
            }
        }
    </style>

    <!-- Configuration Firebase -->
    <script src="firebase-config.js"></script>
    
    <!-- Scripts du jeu -->
    <script src="game.js"></script>
</body>
</html>